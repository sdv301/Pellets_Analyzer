<!-- templates/ai_analysis.html -->
{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <h1 class="text-center mb-4">ü§ñ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ò–ò –ê–Ω–∞–ª–∏–∑</h1>
    
    <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
    <div class="card shadow-sm mb-4" id="system-recommendations" style="display: none;">
        <div class="card-header bg-warning text-dark">
            <h5 class="card-title mb-0">
                <i class="fas fa-lightbulb me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã
            </h5>
        </div>
        <div class="card-body">
            <div id="recommendations-list"></div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-chart-line me-2"></i>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                <button class="btn btn-sm btn-light float-end" onclick="loadSystemStatus()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </h5>
        </div>
        <div class="card-body">
            <div id="system-status">
                <div class="row">
                    <div class="col-md-6">
                        <h6>üìä –î–∞–Ω–Ω—ã–µ:</h6>
                        <ul id="data-status" class="list-unstyled">
                            <li><i class="fas fa-spinner fa-spin me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>ü§ñ ML –ú–æ–¥–µ–ª–∏:</h6>
                        <ul id="ml-status" class="list-unstyled">
                            <li><i class="fas fa-spinner fa-spin me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
                <i class="fas fa-robot me-2"></i>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            </h5>
        </div>
        <div class="card-body">
            <form id="ai-ml-analysis-form">
                <div class="mb-3">
                    <label class="form-label">üí¨ –í–∞—à –∑–∞–ø—Ä–æ—Å –∫ –ò–ò-–∞–Ω–∞–ª–∏—Ç–∏–∫—É:</label>
                    <textarea class="form-control" name="query" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
‚Ä¢ –ù–∞–π–¥–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–µ–ø–ª–æ—Ç—ã —Å–≥–æ—Ä–∞–Ω–∏—è
‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –≤ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ –ö–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ—á–Ω–æ—Å—Ç—å?
‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∂–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞
‚Ä¢ –°—Ä–∞–≤–Ω–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤"></textarea>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-robot me-2"></i>–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="clearAnalysis()">
                        <i class="fas fa-eraser me-2"></i>–û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </form>
            
            <div id="ai-ml-results" class="mt-4"></div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-bolt me-2"></i>–ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
            </h5>
        </div>
        <div class="card-body">
            <div class="row g-2">
                <div class="col-md-4">
                    <button class="btn btn-outline-primary w-100 quick-query" data-query="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –≤ –¥–∞–Ω–Ω—ã—Ö">
                        <i class="fas fa-chart-line me-2"></i>–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-outline-success w-100 quick-query" data-query="–ù–∞–π–¥–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–µ–ø–ª–æ—Ç—ã —Å–≥–æ—Ä–∞–Ω–∏—è">
                        <i class="fas fa-trophy me-2"></i>–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-outline-info w-100 quick-query" data-query="–ö–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ—á–Ω–æ—Å—Ç—å?">
                        <i class="fas fa-cube me-2"></i>–ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-outline-warning w-100 quick-query" data-query="–ü—Ä–µ–¥—Å–∫–∞–∂–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ—Å—Ç–∞–≤–∞: 60% –æ–ø–∏–ª–∫–∏, 30% —Å–æ–ª–æ–º–∞, 10% –ª–∏–≥–Ω–∏–Ω">
                        <i class="fas fa-crystal-ball me-2"></i>–ü—Ä–æ–≥–Ω–æ–∑ —Å–≤–æ–π—Å—Ç–≤
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-outline-danger w-100 quick-query" data-query="–ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ–ª–ª–µ—Ç?">
                        <i class="fas fa-star me-2"></i>–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-outline-dark w-100 quick-query" data-query="–ü—Ä–µ–¥–ª–æ–∂–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π">
                        <i class="fas fa-flask me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ -->
    <div class="card shadow-sm">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤
                <span class="badge bg-secondary" id="history-count">0</span>
            </h5>
        </div>
        <div class="card-body">
            <div id="analysis-history" class="small">
                <div class="text-muted">–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadSystemStatus();
    loadRecommendations();
    loadAnalysisHistory();
    
    // –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    document.querySelectorAll('.quick-query').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelector('textarea[name="query"]').value = this.dataset.query;
            document.querySelector('textarea[name="query"]').focus();
        });
    });
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –∞–Ω–∞–ª–∏–∑–∞
    document.getElementById('ai-ml-analysis-form').addEventListener('submit', function(e) {
        e.preventDefault();
        performAnalysis();
    });
});

async function loadSystemStatus() {
    try {
        const response = await fetch('/ai_ml_system_status');
        const data = await response.json();
        
        if (data.success) {
            updateSystemStatus(data);
        } else {
            showSystemError(data.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞');
        }
    } catch (error) {
        showSystemError(`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
    }
}

function updateSystemStatus(data) {
    const dataSummary = data.data_summary || {};
    const mlStatus = data.ml_status || {};
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã—Ö
    const dataStatus = document.getElementById('data-status');
    if (dataSummary.total_samples > 0) {
        dataStatus.innerHTML = `
            <li><i class="fas fa-database text-success me-2"></i>–û–±—Ä–∞–∑—Ü–æ–≤: <strong>${dataSummary.total_samples}</strong></li>
            <li><i class="fas fa-cube text-success me-2"></i>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: <strong>${dataSummary.total_components}</strong></li>
            <li><i class="fas fa-chart-line text-success me-2"></i>–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: <strong>${dataSummary.available_properties.length}</strong></li>
            <li><i class="fas fa-check-circle text-success me-2"></i>–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å: <strong>${dataSummary.data_completeness}%</strong></li>
        `;
    } else {
        dataStatus.innerHTML = '<li><i class="fas fa-exclamation-triangle text-warning me-2"></i>–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</li>';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å ML –º–æ–¥–µ–ª–µ–π
    const mlStatusElement = document.getElementById('ml-status');
    if (mlStatus.is_trained && mlStatus.trained_models.length > 0) {
        const modelsList = mlStatus.trained_models.map(model => {
            const perf = mlStatus.model_performance[model] || {};
            const statusIcon = perf.status === 'excellent' ? 'fa-check-circle text-success' : 
                             perf.status === 'good' ? 'fa-info-circle text-info' : 'fa-exclamation-triangle text-warning';
            return `<li><i class="fas ${statusIcon} me-2"></i>${model}: R¬≤=${perf.r2_score || 'N/A'}</li>`;
        }).join('');
        mlStatusElement.innerHTML = modelsList;
    } else {
        mlStatusElement.innerHTML = '<li><i class="fas fa-info-circle text-info me-2"></i>–ú–æ–¥–µ–ª–∏ –Ω–µ –æ–±—É—á–µ–Ω—ã</li>';
    }
}

async function loadRecommendations() {
    try {
        const response = await fetch('/ai_ml_recommendations');
        const data = await response.json();
        
        if (data.success && data.recommendations.length > 0) {
            showRecommendations(data.recommendations);
        }
    } catch (error) {
        console.log('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
    }
}

function showRecommendations(recommendations) {
    const container = document.getElementById('system-recommendations');
    const list = document.getElementById('recommendations-list');
    
    const recommendationsHtml = recommendations.map(rec => `
        <div class="alert alert-${rec.priority === 'high' ? 'danger' : 'warning'} mb-2">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>${rec.type === 'data' ? 'üìä –î–∞–Ω–Ω—ã–µ' : rec.type === 'ml' ? 'ü§ñ ML' : '‚ö° –ö–∞—á–µ—Å—Ç–≤–æ'}:</strong>
                    ${rec.message}
                </div>
                <button class="btn btn-sm btn-${rec.priority === 'high' ? 'danger' : 'warning'}" onclick="handleRecommendationAction('${rec.action}')">
                    –ò—Å–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    `).join('');
    
    list.innerHTML = recommendationsHtml;
    container.style.display = 'block';
}

function handleRecommendationAction(action) {
    switch(action) {
        case 'add_data':
            window.location.href = '/';
            break;
        case 'train_ml':
            window.location.href = '/ml_dashboard';
            break;
        case 'improve_data':
            showToast('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–î–æ–±–∞–≤—å—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—ã');
            break;
    }
}

async function performAnalysis() {
    const form = document.getElementById('ai-ml-analysis-form');
    const query = form.querySelector('textarea[name="query"]').value.trim();
    const button = form.querySelector('button[type="submit"]');
    const resultsDiv = document.getElementById('ai-ml-results');
    
    if (!query) {
        showToast('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 'error');
        return;
    }
    
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–ê–Ω–∞–ª–∏–∑...';
    resultsDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>–ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å...</div>';
    
    try {
        const response = await fetch('/ai_ml_analysis', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({query: query})
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAnalysisResult(data);
            loadAnalysisHistory(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
        } else {
            showAnalysisError(data.message || '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞');
        }
    } catch (error) {
        showAnalysisError(`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
    } finally {
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-robot me-2"></i>–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑';
    }
}

function showAnalysisResult(data) {
    const resultsDiv = document.getElementById('ai-ml-results');
    
    let actionsHtml = '';
    if (data.actions && data.actions.length > 0) {
        actionsHtml = `
            <div class="mt-3">
                <h6><i class="fas fa-rocket me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h6>
                <div class="d-flex gap-2 flex-wrap">
                    ${data.actions.map(action => `
                        <button class="btn btn-sm btn-outline-primary" onclick="handleAnalysisAction('${action}')">
                            ${getActionLabel(action)}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    resultsDiv.innerHTML = `
        <div class="alert alert-success">
            <h6><i class="fas fa-chart-line me-2"></i>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞:</h6>
            <div class="mt-3">${formatAnalysisText(data.analysis)}</div>
            ${data.recommendations ? `
            <div class="mt-3">
                <h6><i class="fas fa-lightbulb me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                <div>${formatAnalysisText(data.recommendations)}</div>
            </div>
            ` : ''}
            ${actionsHtml}
        </div>
    `;
}

function handleAnalysisAction(action) {
    const actionUrls = {
        'train_ml': '/ml_dashboard',
        'optimize': '/ml_dashboard',
        'predict': '/ml_dashboard', 
        'add_data': '/',
        'view_tables': '/tables',
        'search': '/tables',
        'compare': '/compare',
        'create_graphs': '/create_graph',
        'analyze': '/ai_analysis'
    };
    
    if (actionUrls[action]) {
        window.location.href = actionUrls[action];
    }
}

function getActionLabel(action) {
    const labels = {
        'train_ml': 'üîÑ –û–±—É—á–∏—Ç—å ML',
        'optimize': 'üéØ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å',
        'predict': 'üîÆ –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å',
        'add_data': 'üìä –î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ',
        'view_tables': 'üìã –¢–∞–±–ª–∏—Ü—ã',
        'search': 'üîç –ü–æ–∏—Å–∫',
        'compare': '‚öñÔ∏è –°—Ä–∞–≤–Ω–∏—Ç—å',
        'create_graphs': 'üìà –ì—Ä–∞—Ñ–∏–∫–∏',
        'analyze': 'ü§ñ –ê–Ω–∞–ª–∏–∑'
    };
    return labels[action] || action;
}

async function loadAnalysisHistory() {
    try {
        const response = await fetch('/ai_ml_history');
        const data = await response.json();
        
        if (data.success) {
            updateAnalysisHistory(data.history);
        }
    } catch (error) {
        console.log('–ò—Å—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
    }
}

function updateAnalysisHistory(history) {
    const container = document.getElementById('analysis-history');
    const countElement = document.getElementById('history-count');
    
    if (!history || history.length === 0) {
        container.innerHTML = '<div class="text-muted">–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</div>';
        countElement.textContent = '0';
        return;
    }
    
    countElement.textContent = history.length;
    
    const historyHtml = history.slice(0, 5).map(item => `
        <div class="border-bottom pb-2 mb-2">
            <div class="d-flex justify-content-between">
                <small class="text-muted">${new Date(item.timestamp).toLocaleString()}</small>
                <span class="badge bg-secondary">${item.type}</span>
            </div>
            <div class="fw-bold">${item.query}</div>
        </div>
    `).join('');
    
    container.innerHTML = historyHtml;
}

function clearAnalysis() {
    document.querySelector('textarea[name="query"]').value = '';
    document.getElementById('ai-ml-results').innerHTML = '';
}

function showSystemError(message) {
    const dataStatus = document.getElementById('data-status');
    const mlStatus = document.getElementById('ml-status');
    
    dataStatus.innerHTML = `<li><i class="fas fa-exclamation-triangle text-danger me-2"></i>${message}</li>`;
    mlStatus.innerHTML = `<li><i class="fas fa-exclamation-triangle text-danger me-2"></i>${message}</li>`;
}

function showAnalysisError(message) {
    const resultsDiv = document.getElementById('ai-ml-results');
    resultsDiv.innerHTML = `
        <div class="alert alert-danger">
            <h6><i class="fas fa-exclamation-triangle me-2"></i>–û—à–∏–±–∫–∞:</h6>
            ${message}
        </div>
    `;
}

function showToast(title, message, type = 'info') {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
    toast.innerHTML = `
        <strong>${title}</strong> ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) toast.parentNode.removeChild(toast);
    }, 5000);
}

function formatAnalysisText(text) {
    return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>')
        .replace(/‚úÖ/g, '<span class="text-success">‚úÖ</span>')
        .replace(/‚ö†Ô∏è/g, '<span class="text-warning">‚ö†Ô∏è</span>')
        .replace(/‚ùå/g, '<span class="text-danger">‚ùå</span>');
}
</script>
{% endblock %}