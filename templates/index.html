{% extends 'base.html' %}

{% block title %}Главная{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header pb-0">
                    <h6>Загрузка файла</h6>
                </div>
                <div class="card-body">
                    {% for message in messages %}
                        <div class="alert alert-{{ 'danger' if 'Error' in message or 'Warning' in message else 'success' }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                    <form method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="file" class="form-label">Выберите CSV или Excel файл</label>
                            <input type="file" class="form-control" id="file" name="file" accept=".csv,.xlsx">
                        </div>
                        <button type="submit" class="btn btn-primary">Загрузить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if show_data %}
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6>Загруженная таблица</h6>
                    </div>
                    <div class="card-body">
                        {{ measured_data | safe }}
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6>Поиск по данным</h6>
                    </div>
                    <div class="card-body">
                        <form method="post" class="row g-3">
                            <div class="col-md-4">
                                <label for="rho" class="form-label">ρ (не менее), кг/м3</label>
                                <input type="number" class="form-control" id="rho" name="rho">
                            </div>
                            <div class="col-md-4">
                                <label for="kt" class="form-label">Kt (не менее), %</label>
                                <input type="number" class="form-control" id="kt" name="kt">
                            </div>
                            <div class="col-md-4">
                                <label for="ad" class="form-label">Ad (не более), %</label>
                                <input type="number" class="form-control" id="ad" name="ad">
                            </div>
                            <div class="col-md-4">
                                <label for="q" class="form-label">Q (не менее), МДж/кг</label>
                                <input type="number" class="form-control" id="q" name="q">
                            </div>
                            <div class="col-md-4">
                                <label for="num_components" class="form-label">Компонентов (не более), шт</label>
                                <input type="number" class="form-control" id="num_components" name="num_components">
                            </div>
                            <div class="col-12">
                                <button type="submit" name="search" class="btn btn-primary">Найти</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">Добавить данные</button>
            </div>
        </div>
    {% endif %}

    <!-- Модальное окно для добавления данных -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="card">
                <div class="card-header pb-0">
                    <h5 class="modal-title" id="addModalLabel">Добавить новый состав</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ url_for('add_data') }}">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="composition" class="form-label">Составы</label>
                                <input type="text" class="form-control" name="composition" required>
                            </div>
                            <div class="col-md-6">
                                <label for="density" class="form-label">ρ, кг/м3</label>
                                <input type="number" class="form-control" name="density" required>
                            </div>
                            <div class="col-md-6">
                                <label for="kf" class="form-label">Kf, %</label>
                                <input type="number" class="form-control" name="kf" required>
                            </div>
                            <div class="col-md-6">
                                <label for="kt" class="form-label">Kt, %</label>
                                <input type="number" class="form-control" name="kt" required>
                            </div>
                            <div class="col-md-6">
                                <label for="h" class="form-label">H, %</label>
                                <input type="number" class="form-control" name="h" required>
                            </div>
                            <div class="col-md-6">
                                <label for="mass_loss" class="form-label">Mass loss, %</label>
                                <input type="number" class="form-control" name="mass_loss" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tign" class="form-label">Тign, °С</label>
                                <input type="number" class="form-control" name="tign" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tb" class="form-label">Tb, °C</label>
                                <input type="number" class="form-control" name="tb" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tau_d1" class="form-label">τd1, с</label>
                                <input type="number" class="form-control" name="tau_d1" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tau_d2" class="form-label">τd2, с</label>
                                <input type="number" class="form-control" name="tau_d2" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tau_b" class="form-label">τb, с</label>
                                <input type="number" class="form-control" name="tau_b" required>
                            </div>
                            <div class="col-md-6">
                                <label for="co2" class="form-label">CO2, %</label>
                                <input type="number" class="form-control" name="co2" required>
                            </div>
                            <div class="col-md-6">
                                <label for="co" class="form-label">CO, %</label>
                                <input type="number" class="form-control" name="co" required>
                            </div>
                            <div class="col-md-6">
                                <label for="so2" class="form-label">SO2, ppm</label>
                                <input type="number" class="form-control" name="so2" required>
                            </div>
                            <div class="col-md-6">
                                <label for="nox" class="form-label">NOx, ppm</label>
                                <input type="number" class="form-control" name="nox" required>
                            </div>
                            <div class="col-md-6">
                                <label for="q" class="form-label">Q, МДж/кг</label>
                                <input type="number" class="form-control" name="q" required>
                            </div>
                            <div class="col-md-6">
                                <label for="ad" class="form-label">Ad, %</label>
                                <input type="number" class="form-control" name="ad" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">Добавить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}